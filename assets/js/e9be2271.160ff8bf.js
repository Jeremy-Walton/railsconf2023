"use strict";(self.webpackChunkrailsconf_2023=self.webpackChunkrailsconf_2023||[]).push([[470],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>m});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=p(a),h=i,m=c["".concat(s,".").concat(h)]||c[h]||u[h]||r;return a?n.createElement(m,l(l({ref:t},d),{},{components:a})):n.createElement(m,l({ref:t},d))}));function m(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=h;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"},5408:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294);const i={card:"card_vceO",image:"image_EDOu",description:"description_Vdg7",position:"position_CmtU"};function r(e){let{imageUrl:t,name:a,position:r}=e;return n.createElement("div",{className:i.card},n.createElement("img",{src:t,className:i.image}),n.createElement("div",{className:i.description},n.createElement("p",null,a),n.createElement("p",{className:i.position},r)))}},9267:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});var n=a(7462),i=(a(7294),a(3905)),r=a(5408);const l={sidebar_position:9},o="Building an offline experience with a Rails-powered PWA",s={unversionedId:"day-two/pwa",id:"day-two/pwa",title:"Building an offline experience with a Rails-powered PWA",description:"Progressive web applications (PWAs) allow us to provide rich offline experiences as native apps would, while still being easy to use and share, as web apps are.",source:"@site/docs/day-two/pwa.mdx",sourceDirName:"day-two",slug:"/day-two/pwa",permalink:"/railsconf2023/docs/day-two/pwa",draft:!1,editUrl:"https://github.com/Jeremy-Walton/railsconf2023/tree/main/packages/create-docusaurus/templates/shared/docs/day-two/pwa.mdx",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"A custom design pattern for building dynamic ActiveRecord queries",permalink:"/railsconf2023/docs/day-two/queries"},next:{title:"Applying microservices patterns to a modular monolith",permalink:"/railsconf2023/docs/day-two/microservices"}},p={},d=[{value:"Attendees",id:"attendees",level:2},{value:"Notes",id:"notes",level:2},{value:"What is a PWA and why the are great",id:"what-is-a-pwa-and-why-the-are-great",level:3},{value:"Case study: Introducing the challenge and solution",id:"case-study-introducing-the-challenge-and-solution",level:3},{value:"Solution",id:"solution",level:4},{value:"Setting up the main files required for PWAs",id:"setting-up-the-main-files-required-for-pwas",level:3},{value:"Caching and adding an offline fallback",id:"caching-and-adding-an-offline-fallback",level:3},{value:"Workbox",id:"workbox",level:4},{value:"Workbox Strategies",id:"workbox-strategies",level:4},{value:"Offline fallback",id:"offline-fallback",level:4},{value:"Offline CRU(D) actions",id:"offline-crud-actions",level:3},{value:"IndexedDB",id:"indexeddb",level:4},{value:"Background Sync API",id:"background-sync-api",level:4},{value:"Store records in IndexedDB with Stimulus",id:"store-records-in-indexeddb-with-stimulus",level:4},{value:"What if we want to enable manual synchronization?",id:"what-if-we-want-to-enable-manual-synchronization",level:4},{value:"How do we allow users to interact with app data when no internet?",id:"how-do-we-allow-users-to-interact-with-app-data-when-no-internet",level:4},{value:"Gotchas",id:"gotchas",level:4},{value:"Key takeaways and furthers challenges",id:"key-takeaways-and-furthers-challenges",level:3},{value:"Resources",id:"resources",level:3}],c={toc:d},u="wrapper";function h(e){let{components:t,...a}=e;return(0,i.kt)(u,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"building-an-offline-experience-with-a-rails-powered-pwa"},"Building an offline experience with a Rails-powered PWA"),(0,i.kt)("p",null,"Progressive web applications (PWAs) allow us to provide rich offline experiences as native apps would, while still being easy to use and share, as web apps are."),(0,i.kt)(r.Z,{name:"Alicia Rojas",position:"Software Developer at Telos Labs",imageUrl:"https://sessionize.com/image/e344-400o400o2-hLMBzgXgptTcbNESM5vRfr.jpg",mdxType:"Speaker"}),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://railsconf2023.sessionize.com/session/452793"},"Schedule Entry")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://docs.google.com/presentation/d/1CwWOAgrfNg3yR07EGAbYDxd50A0BovEtpkmofwN9fZQ/edit#slide=id.p"},"Slides")),(0,i.kt)("h2",{id:"attendees"},"Attendees"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Jeremy"),(0,i.kt)("li",{parentName:"ul"},"Josh")),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Relevancy"),(0,i.kt)("th",{parentName:"tr",align:null},"Interesting"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"5"),(0,i.kt)("td",{parentName:"tr",align:null},"4")))),(0,i.kt)("h2",{id:"notes"},"Notes"),(0,i.kt)("p",null,"The first half of the talk covers the basics which we have implemented before, but the second half talks about caching and offline CRUD which may be useful."),(0,i.kt)("h3",{id:"what-is-a-pwa-and-why-the-are-great"},"What is a PWA and why the are great"),(0,i.kt)("p",null,"Progressive Web App\nWeb apps that use service workers, manifests, and other features in combo with pgrowessive enhancement to give users an experience with native applications.\nThey mix the bet of both native and web worlds."),(0,i.kt)("h3",{id:"case-study-introducing-the-challenge-and-solution"},"Case study: Introducing the challenge and solution"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create an alpo that allows to perform CRUD actions in areas with low or no internet connections."),(0,i.kt)("li",{parentName:"ul"},"The has to be easy to use and share, and must work on mobile devices.")),(0,i.kt)("h4",{id:"solution"},"Solution"),(0,i.kt)("p",null,"Rails + PWA"),(0,i.kt)("p",null,"The ingredients"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Service worker.",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Is like a small application that runs in parallel to your Rails app, intercepting requests and providing capabilities like coaching assets and background sync."),(0,i.kt)("li",{parentName:"ol"},"Available at ",(0,i.kt)("inlineCode",{parentName:"li"},"/service-worker.js")),(0,i.kt)("li",{parentName:"ol"},"Your app should work even if the worker doesn\u2019t"))),(0,i.kt)("li",{parentName:"ol"},"App manifest",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"It will tell the browser how your PWA should display within the OS of the device. This file is key to make your app installable and thus to make it look and feel like a native app."),(0,i.kt)("li",{parentName:"ol"},"Available at ",(0,i.kt)("inlineCode",{parentName:"li"},"/manifest.json"))))),(0,i.kt)("h3",{id:"setting-up-the-main-files-required-for-pwas"},"Setting up the main files required for PWAs"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Create a service worker controller"),(0,i.kt)("li",{parentName:"ol"},"Add routes"),(0,i.kt)("li",{parentName:"ol"},"Add files (service worker and manifest)"),(0,i.kt)("li",{parentName:"ol"},"Write companion JS and place It in the asset pipeline")),(0,i.kt)("p",null,"Can serve the files as views. ",(0,i.kt)("inlineCode",{parentName:"p"},"manifest.json.erb"),"\nRequire the manifest in the application layout using a link"),(0,i.kt)("p",null,"Companion JS tells your application when and  from where to load your service worker."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// App/javascript/custom/companion.js\nIf (navigator.serviceWorker) {\n  // Do stuff, register etc.\n}\n")),(0,i.kt)("h3",{id:"caching-and-adding-an-offline-fallback"},"Caching and adding an offline fallback"),(0,i.kt)("h4",{id:"workbox"},"Workbox"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Set of modules that simplify common service worker routing and caching"),(0,i.kt)("li",{parentName:"ul"},"Workbox makes writing a service worker much easier.")),(0,i.kt)("h4",{id:"workbox-strategies"},"Workbox Strategies"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Commonly used patterns to determine how the service worker will generate a response when a fetch event is received"),(0,i.kt)("li",{parentName:"ul"},"The service worker handles the response by \u201crouting\u201d it to the particular strategy we want to use.")),(0,i.kt)("h4",{id:"offline-fallback"},"Offline fallback"),(0,i.kt)("p",null,"Set up a catch handler."),(0,i.kt)("h3",{id:"offline-crud-actions"},"Offline CRU(D) actions"),(0,i.kt)("h4",{id:"indexeddb"},"IndexedDB"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Javascript API for managing a database of JSON objects in your browser"),(0,i.kt)("li",{parentName:"ul"},"Relies heavily on Promises"),(0,i.kt)("li",{parentName:"ul"},"Recommendation: use a wrapper!",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://dexie.org/"},"Dexie.js - Minimalistic IndexedDB Wrapper"))))),(0,i.kt)("h4",{id:"background-sync-api"},"Background Sync API"),(0,i.kt)("p",null,"Allows web applications to defer server synchronization."),(0,i.kt)("h4",{id:"store-records-in-indexeddb-with-stimulus"},"Store records in IndexedDB with Stimulus"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Check network status"),(0,i.kt)("li",{parentName:"ol"},"Declare database"),(0,i.kt)("li",{parentName:"ol"},"When submitting a form, if no network is available, store record in IndexedDB.\nPro Tip: Use mixin.")),(0,i.kt)("h4",{id:"what-if-we-want-to-enable-manual-synchronization"},"What if we want to enable manual synchronization?"),(0,i.kt)("p",null,"Failed Sync, or browser doesn\u2019t support or is disabled.\nMay want to allow users control over when the sync happens."),(0,i.kt)("h4",{id:"how-do-we-allow-users-to-interact-with-app-data-when-no-internet"},"How do we allow users to interact with app data when no internet?"),(0,i.kt)("p",null,"Server side rendering is out.\nStimulus\nHTML templates are your friends. Use JS to\nStimulus + Mustache to populate the template with IndexedDB."),(0,i.kt)("h4",{id:"gotchas"},"Gotchas"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Validations in the front-end and backend must match, to ensure sync does not fail due to validation errors."),(0,i.kt)("li",{parentName:"ul"},"Understand your audience to assess the importance of browser compatibility for PWA capabilities (especially regarding iOS support)")),(0,i.kt)("h3",{id:"key-takeaways-and-furthers-challenges"},"Key takeaways and furthers challenges"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"PWA features can super-charge your app to make it suitable for everyone, everywhere."),(0,i.kt)("li",{parentName:"ul"},"We can make a great impact by reaching unconventional Audiences"),(0,i.kt)("li",{parentName:"ul"},"Stimulus is a powerful tool for enhancing our app with offline features, emulating a SPA behavior with minimum JS.")),(0,i.kt)("h3",{id:"resources"},"Resources"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://hi.teloslabs.co/post/make-your-rails-app-work-offline-part-1-pwa-setup"},"Make your Rails app work offline (Part 1: PWA setup)")),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://hi.teloslabs.co/post/make-your-rails-app-work-offline-part-2-caching-assets-and-adding-an-offline-fallback"},"Make your Rails app work offline (Part 2: caching assets and adding an offline fallback)")))}h.isMDXComponent=!0}}]);